import Head from 'next/head'
import Banner from '../components/Banner/Banner'
import Card from '../components/Card/Card'
import CardContainer from '../components/Card/CardContainer'
import NavBar from '../components/NavBar/NavBar'
import { getVideos, getPopularVideos, fetchWatchedVideos } from '../lib/videos'
import { verifyToken } from '../lib/utils'

import styles from '../styles/Home.module.css'
import redirectUser from '../utils/redirectUser'

export async function getServerSideProps(context) {
  const { userId, token } = await redirectUser(context)

  const disneyVideos = await getVideos('disney trailer')
  const productivityVideos = await getVideos('friends')
  const travelVideos = await getVideos('javascript')
  const popularVideos = await getPopularVideos('')
  const watchedAgainVidoes = await fetchWatchedVideos(userId, token)

  return {
    props: {
      disneyVideos,
      productivityVideos,
      travelVideos,
      popularVideos,
      watchedAgainVidoes
    }
  }
}
// const key = AIzaSyAjJ4qNerU5yPdMYYGx3IXFOdsr8VkUTV4
export default function Home({
  disneyVideos,
  productivityVideos,
  travelVideos,
  popularVideos,
  watchedAgainVidoes = []
}) {
  return (
    <div className={styles.container}>
      <Head>
        <title>My youtube</title>
        <meta name='description' content='Generated by create next app' />
      </Head>
      {/* <h1>my youtube</h1> */}
      <div className={styles.main}>
        <NavBar />
        <Banner
          videoId={'4KPTXpQehio'}
          title={'Toy Story'}
          subTitle={'Toy Stroy'}
          imgUrl={'/static/toy-story.webp'}
        />
        <div className={styles.cardContainer}>
          <CardContainer title={'disney'} videos={disneyVideos} size={'large'} />
          <CardContainer
            title={'watch it again'}
            videos={watchedAgainVidoes}
            size={'medium'}
          />
          <CardContainer title={'javascript'} videos={travelVideos} size={'small'} />
          <CardContainer title={'Friends'} videos={productivityVideos} size={'medium'} />
          <CardContainer title={'Popular'} videos={popularVideos} size={'small'} />
        </div>
      </div>
    </div>
  )
}
